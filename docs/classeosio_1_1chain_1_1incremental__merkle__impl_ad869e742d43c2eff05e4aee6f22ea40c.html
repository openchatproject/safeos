<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Eos: eosio::chain::incremental_merkle_impl::append</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Eos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceeosio.html">eosio</a></li><li class="navelem"><a class="el" href="namespaceeosio_1_1chain.html">chain</a></li><li class="navelem"><a class="el" href="classeosio_1_1chain_1_1incremental__merkle__impl.html">incremental_merkle_impl</a></li>  </ul>
</div>
</div><!-- top -->
<div class="contents">
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td valign="top">
      <div class="navtab">
        <table>
          <tr><td class="navtab"><a class="qindex" href="classeosio_1_1chain_1_1incremental__merkle__impl_a0b9ec4d8a513ae115d24b7c2b513bf5a.html#a0b9ec4d8a513ae115d24b7c2b513bf5a">_active_nodes</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="classeosio_1_1chain_1_1incremental__merkle__impl_ab5a4971b8e31baebc2d04342d1ac1bb5.html#ab5a4971b8e31baebc2d04342d1ac1bb5">_node_count</a></td></tr>
          <tr><td class="navtab"><a class="qindexHL" href="classeosio_1_1chain_1_1incremental__merkle__impl_ad869e742d43c2eff05e4aee6f22ea40c.html#ad869e742d43c2eff05e4aee6f22ea40c">append</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="classeosio_1_1chain_1_1incremental__merkle__impl_a5edecdbfa376be54e9cb274edcf6371a.html#a5edecdbfa376be54e9cb274edcf6371a">get_root</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="classeosio_1_1chain_1_1incremental__merkle__impl_aa43371746d7e662a6ffab9791da9b8a4.html#aa43371746d7e662a6ffab9791da9b8a4">incremental_merkle_impl</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="classeosio_1_1chain_1_1incremental__merkle__impl_a0baa643e8e7761b52f46a94a2c0855d9.html#a0baa643e8e7761b52f46a94a2c0855d9">incremental_merkle_impl</a></td></tr>
        </table>
      </div>
   </td>
   <td valign="top" class="mempage">
<a id="ad869e742d43c2eff05e4aee6f22ea40c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad869e742d43c2eff05e4aee6f22ea40c">&#9670;&nbsp;</a></span>append()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename DigestType, template&lt; typename ... &gt; class Container = vector, typename ... Args&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const DigestType&amp; <a class="el" href="classeosio_1_1chain_1_1incremental__merkle__impl.html">eosio::chain::incremental_merkle_impl</a>&lt; DigestType, Container, Args &gt;::append </td>
          <td>(</td>
          <td class="paramtype">const DigestType &amp;&#160;</td>
          <td class="paramname"><em>digest</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Add a node to the incremental tree and recalculate the _active_nodes so they are prepared for the next append.</p>
<p>The algorithm for this is to start at the new node and retreat through the tree for any node that is the concatenation of a fully-realized node and a partially realized node we must record the value of the fully-realized node in the new _active_nodes so that the next append can fetch it. Fully realized nodes and Fully implied nodes do not have an effect on the _active_nodes.</p>
<p>For convention <em>AND</em> to allow appends when the _node_count is a power-of-2, the current root of the incremental tree is always appended to the end of the new _active_nodes.</p>
<p>In practice, this can be done iteratively by recording any "left" value that is to be combined with an implied node.</p>
<p>If the appended node is a "left" node in its pair, it will immediately push itself into the new active nodes list.</p>
<p>If the new node is a "right" node it will begin collapsing upward in the tree, reading and discarding the "left" node data from the old active nodes list, until it becomes a "left" node. It must then push the "top" of its current collapsed sub-tree into the new active nodes list.</p>
<p>Once any value has been added to the new active nodes, all remaining "left" nodes should be present in the order they are needed in the previous active nodes as an artifact of the previous append. As they are read from the old active nodes, they will need to be copied in to the new active nodes list as they are still needed for future appends.</p>
<p>As a result, if an append collapses the entire tree while always being the "right" node, the new list of active nodes will be empty and by definition the tree contains a power-of-2 number of nodes.</p>
<p>Regardless of the contents of the new active nodes list, the top "collapsed" value is appended. If this tree is <em>not</em> a power-of-2 number of nodes, this node will not be used in the next append but still serves as a conventional place to access the root of the current tree. If this <em>is</em> a power-of-2 number of nodes, this node will be needed during then collapse phase of the next append so, it serves double duty as a legitimate active node and the conventional storage location of the root.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">digest</td><td>- the node to add </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- the new root </dd></dl>

<p class="definition">Definition at line <a class="el" href="incremental__merkle_8hpp_source.html#l00163">163</a> of file <a class="el" href="incremental__merkle_8hpp_source.html">incremental_merkle.hpp</a>.</p>

</div>
</div>
    </td>
  </tr>
</table>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue May 29 2018 17:40:58 for Eos by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
