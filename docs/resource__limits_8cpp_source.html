<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Eos: libraries/chain/resource_limits.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Eos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_94df585d4e205d65756e56c0817a7014.html">chain</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">resource_limits.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="resource__limits_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="exceptions_8hpp.html">eosio/chain/exceptions.hpp</a>&gt;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="resource__limits_8hpp.html">eosio/chain/resource_limits.hpp</a>&gt;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="resource__limits__private_8hpp.html">eosio/chain/resource_limits_private.hpp</a>&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="transaction__metadata_8hpp.html">eosio/chain/transaction_metadata.hpp</a>&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="transaction_8hpp.html">eosio/chain/transaction.hpp</a>&gt;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceeosio.html">eosio</a> { <span class="keyword">namespace </span>chain { <span class="keyword">namespace </span>resource_limits {</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;static_assert( config::rate_limiting_precision &gt; 0, <span class="stringliteral">&quot;config::rate_limiting_precision must be positive&quot;</span> );</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">static</span> uint64_t update_elastic_limit(uint64_t current_limit, uint64_t average_usage, <span class="keyword">const</span> elastic_limit_parameters&amp; params) {</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;   uint64_t result = current_limit;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;   <span class="keywordflow">if</span> (average_usage &gt; params.target ) {</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;      result = result * params.contract_rate;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;      result = result * params.expand_rate;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;   }</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;   <span class="keywordflow">return</span> std::min(std::max(result, params.max), params.max * params.max_multiplier);</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;}</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_a9439de3195bb5f67f8ccfe442e7d12e3.html#a9439de3195bb5f67f8ccfe442e7d12e3">   22</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_a9439de3195bb5f67f8ccfe442e7d12e3.html#a9439de3195bb5f67f8ccfe442e7d12e3">elastic_limit_parameters::validate</a>()<span class="keyword">const </span>{</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;   <span class="comment">// At the very least ensure parameters are not set to values that will cause divide by zero errors later on.</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;   <span class="comment">// Stricter checks for sensible values can be added later.</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;   FC_ASSERT( <a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_a91a58a56b53c661d3415718ddbf70590.html#a91a58a56b53c661d3415718ddbf70590">periods</a> &gt; 0, <span class="stringliteral">&quot;elastic limit parameter &#39;periods&#39; cannot be zero&quot;</span> );</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;   FC_ASSERT( <a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_ad8118fb8df0d8f14392e7b5f0972fe39.html#ad8118fb8df0d8f14392e7b5f0972fe39">contract_rate</a>.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1impl_1_1ratio_a21b9ea82988a1ec7634c48bafa5daabb.html#a21b9ea82988a1ec7634c48bafa5daabb">denominator</a> &gt; 0, <span class="stringliteral">&quot;elastic limit parameter &#39;contract_rate&#39; is not a well-defined ratio&quot;</span> );</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;   FC_ASSERT( <a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_a280e6a4a44264c526a6e013621b47f79.html#a280e6a4a44264c526a6e013621b47f79">expand_rate</a>.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1impl_1_1ratio_a21b9ea82988a1ec7634c48bafa5daabb.html#a21b9ea82988a1ec7634c48bafa5daabb">denominator</a> &gt; 0,   <span class="stringliteral">&quot;elastic limit parameter &#39;expand_rate&#39; is not a well-defined ratio&quot;</span> );</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;}</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keywordtype">void</span> resource_limits_state_object::update_virtual_cpu_limit( <span class="keyword">const</span> <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&amp; cfg ) {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;   <span class="comment">//idump((average_block_cpu_usage.average()));</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;   virtual_cpu_limit = update_elastic_limit(virtual_cpu_limit, average_block_cpu_usage.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1impl_1_1exponential__moving__average__accumulator_a26198afc99c94594bcbd626637be593d.html#a26198afc99c94594bcbd626637be593d">average</a>(), cfg.cpu_limit_parameters);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;   <span class="comment">//idump((virtual_cpu_limit));</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;}</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keywordtype">void</span> resource_limits_state_object::update_virtual_net_limit( <span class="keyword">const</span> resource_limits_config_object&amp; cfg ) {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;   virtual_net_limit = update_elastic_limit(virtual_net_limit, average_block_net_usage.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1impl_1_1exponential__moving__average__accumulator_a26198afc99c94594bcbd626637be593d.html#a26198afc99c94594bcbd626637be593d">average</a>(), cfg.net_limit_parameters);</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;}</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ae5bf9dae31e77d62b013a6590911f627.html#ae5bf9dae31e77d62b013a6590911f627">   41</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ae5bf9dae31e77d62b013a6590911f627.html#ae5bf9dae31e77d62b013a6590911f627">resource_limits_manager::add_indices</a>() {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;   _db.add_index&lt;<a class="code" href="namespaceeosio_1_1chain_1_1resource__limits_a5118123f745056c6e5112c6abf938428.html#a5118123f745056c6e5112c6abf938428">resource_limits_index</a>&gt;();</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;   _db.add_index&lt;<a class="code" href="namespaceeosio_1_1chain_1_1resource__limits_a1a12778be310d2a726ef83c22904f1d0.html#a1a12778be310d2a726ef83c22904f1d0">resource_usage_index</a>&gt;();</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;   _db.add_index&lt;<a class="code" href="namespaceeosio_1_1chain_1_1resource__limits_ab61fbfbc70031ab9867143d6fb6cc168.html#ab61fbfbc70031ab9867143d6fb6cc168">resource_limits_state_index</a>&gt;();</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;   _db.add_index&lt;<a class="code" href="namespaceeosio_1_1chain_1_1resource__limits_ac065b1ca4a1b36442cc4da7ab645ff77.html#ac065b1ca4a1b36442cc4da7ab645ff77">resource_limits_config_index</a>&gt;();</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;}</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a20d3da9fa3e3c322db28670d4f2e589b.html#a20d3da9fa3e3c322db28670d4f2e589b">   48</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a20d3da9fa3e3c322db28670d4f2e589b.html#a20d3da9fa3e3c322db28670d4f2e589b">resource_limits_manager::initialize_database</a>() {</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; config = _db.create&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;([](<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&amp; config){</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      <span class="comment">// see default settings in the declaration</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;   });</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;   _db.create&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;([&amp;config](<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&amp; state){</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      <span class="comment">// see default settings in the declaration</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <span class="comment">// start the chain off in a way that it is &quot;congested&quot; aka slow-start</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      state.virtual_cpu_limit = config.cpu_limit_parameters.max;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      state.virtual_net_limit = config.net_limit_parameters.max;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;   });</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;}</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a453dba43454b8498745200b37f658b26.html#a453dba43454b8498745200b37f658b26">   62</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a453dba43454b8498745200b37f658b26.html#a453dba43454b8498745200b37f658b26">resource_limits_manager::initialize_account</a>(<span class="keyword">const</span> <a class="code" href="structeosio_1_1chain_1_1name.html">account_name</a>&amp; account) {</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;   _db.create&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>&gt;([&amp;]( <a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>&amp; bl ) {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      bl.owner = account;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;   });</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;   _db.create&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>&gt;([&amp;]( <a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>&amp; bu ) {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      bu.owner = account;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;   });</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;}</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ae23ed59666148549091ebb2b8d47922c.html#ae23ed59666148549091ebb2b8d47922c">   72</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ae23ed59666148549091ebb2b8d47922c.html#ae23ed59666148549091ebb2b8d47922c">resource_limits_manager::set_block_parameters</a>(<span class="keyword">const</span> <a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html">elastic_limit_parameters</a>&amp; cpu_limit_parameters, <span class="keyword">const</span> <a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html">elastic_limit_parameters</a>&amp; net_limit_parameters ) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;   cpu_limit_parameters.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_a9439de3195bb5f67f8ccfe442e7d12e3.html#a9439de3195bb5f67f8ccfe442e7d12e3">validate</a>();</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;   net_limit_parameters.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_a9439de3195bb5f67f8ccfe442e7d12e3.html#a9439de3195bb5f67f8ccfe442e7d12e3">validate</a>();</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; config = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;   _db.modify(config, [&amp;](<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&amp; c){</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      c.cpu_limit_parameters = cpu_limit_parameters;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      c.net_limit_parameters = net_limit_parameters;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;   });</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a35a91a5e0e990a9f1a02c7c996ec58d4.html#a35a91a5e0e990a9f1a02c7c996ec58d4">   82</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a35a91a5e0e990a9f1a02c7c996ec58d4.html#a35a91a5e0e990a9f1a02c7c996ec58d4">resource_limits_manager::update_account_usage</a>(<span class="keyword">const</span> flat_set&lt;account_name&gt;&amp; accounts, uint32_t time_slot ) {</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; config = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;   <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span>&amp; a : accounts ) {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; usage = _db.get&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>,by_owner&gt;( a );</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      _db.modify( usage, [&amp;]( <span class="keyword">auto</span>&amp; bu ){</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;          bu.net_usage.add( 0, time_slot, config.account_net_usage_average_window );</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;          bu.cpu_usage.add( 0, time_slot, config.account_cpu_usage_average_window );</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      });</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;   }</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;}</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a57a20fa67d4f071957bea7c5e138844b.html#a57a20fa67d4f071957bea7c5e138844b">   93</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a57a20fa67d4f071957bea7c5e138844b.html#a57a20fa67d4f071957bea7c5e138844b">resource_limits_manager::add_transaction_usage</a>(<span class="keyword">const</span> flat_set&lt;account_name&gt;&amp; accounts, uint64_t cpu_usage, uint64_t net_usage, uint32_t time_slot ) {</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; state = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; config = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;   set&lt;std::pair&lt;account_name, permission_name&gt;&gt; authorizing_accounts;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;   <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span>&amp; a : accounts ) {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; usage = _db.get&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>,by_owner&gt;( a );</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      int64_t unused;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      int64_t net_weight;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      int64_t cpu_weight;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a39d7f523fa141beefd266c031db80322.html#a39d7f523fa141beefd266c031db80322">get_account_limits</a>( a, unused, net_weight, cpu_weight );</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      _db.modify( usage, [&amp;]( <span class="keyword">auto</span>&amp; bu ){</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;          bu.net_usage.add( net_usage, time_slot, config.account_net_usage_average_window );</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;          bu.cpu_usage.add( cpu_usage, time_slot, config.account_cpu_usage_average_window );</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      });</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <span class="keywordflow">if</span>( cpu_weight &gt;= 0 &amp;&amp; state.total_cpu_weight &gt; 0 ) {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;         <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> window_size = config.account_cpu_usage_average_window;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;         <span class="keyword">auto</span> virtual_network_capacity_in_window = state.virtual_cpu_limit * window_size;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;         <span class="keyword">auto</span> cpu_used_in_window                 = (usage.cpu_usage.value_ex * window_size) / config::rate_limiting_precision;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;         <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> user_weight     = cpu_weight;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;         <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> all_user_weight = state.total_cpu_weight;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;         <span class="keyword">auto</span> max_user_use_in_window = (virtual_network_capacity_in_window * user_weight) / all_user_weight;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;         <a class="code" href="exceptions_8hpp_a2cb5d7112457a24df46ffcd923270e16.html#a2cb5d7112457a24df46ffcd923270e16">EOS_ASSERT</a>( cpu_used_in_window &lt;= max_user_use_in_window,</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                     tx_cpu_usage_exceeded,</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                     <span class="stringliteral">&quot;authorizing account &#39;${n}&#39; has insufficient cpu resources for this transaction&quot;</span>,</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                     (<span class="stringliteral">&quot;n&quot;</span>, <a class="code" href="structeosio_1_1chain_1_1name.html">name</a>(a))</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                     (<span class="stringliteral">&quot;cpu_used_in_window&quot;</span>,cpu_used_in_window)</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                     (<span class="stringliteral">&quot;max_user_use_in_window&quot;</span>,max_user_use_in_window) );</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="keywordflow">if</span>( net_weight &gt;= 0 &amp;&amp; state.total_net_weight &gt; 0) {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;         <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> window_size = config.account_net_usage_average_window;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;         <span class="keyword">auto</span> virtual_network_capacity_in_window = state.virtual_net_limit * window_size;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;         <span class="keyword">auto</span> net_used_in_window                 = (usage.net_usage.value_ex * window_size) / config::rate_limiting_precision;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;         <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> user_weight     = net_weight;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;         <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> all_user_weight = state.total_net_weight;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;         <span class="keyword">auto</span> max_user_use_in_window = (virtual_network_capacity_in_window * user_weight) / all_user_weight;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;         <a class="code" href="exceptions_8hpp_a2cb5d7112457a24df46ffcd923270e16.html#a2cb5d7112457a24df46ffcd923270e16">EOS_ASSERT</a>( net_used_in_window &lt;= max_user_use_in_window,</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                     tx_net_usage_exceeded,</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                     <span class="stringliteral">&quot;authorizing account &#39;${n}&#39; has insufficient net resources for this transaction&quot;</span>,</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                     (<span class="stringliteral">&quot;n&quot;</span>, <a class="code" href="structeosio_1_1chain_1_1name.html">name</a>(a))</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                     (<span class="stringliteral">&quot;net_used_in_window&quot;</span>,net_used_in_window)</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                     (<span class="stringliteral">&quot;max_user_use_in_window&quot;</span>,max_user_use_in_window) );</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;   }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;   <span class="comment">// account for this transaction in the block and do not exceed those limits either</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;   _db.modify(state, [&amp;](<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&amp; rls){</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      rls.pending_cpu_usage += cpu_usage;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      rls.pending_net_usage += net_usage;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;   });</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;   <a class="code" href="exceptions_8hpp_a2cb5d7112457a24df46ffcd923270e16.html#a2cb5d7112457a24df46ffcd923270e16">EOS_ASSERT</a>( state.pending_cpu_usage &lt;= config.cpu_limit_parameters.max, block_resource_exhausted, <span class="stringliteral">&quot;Block has insufficient cpu resources&quot;</span> );</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;   <a class="code" href="exceptions_8hpp_a2cb5d7112457a24df46ffcd923270e16.html#a2cb5d7112457a24df46ffcd923270e16">EOS_ASSERT</a>( state.pending_net_usage &lt;= config.net_limit_parameters.max, block_resource_exhausted, <span class="stringliteral">&quot;Block has insufficient net resources&quot;</span> );</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;}</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a221e58d79e2b684714cb1acc19da5492.html#a221e58d79e2b684714cb1acc19da5492">  160</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a221e58d79e2b684714cb1acc19da5492.html#a221e58d79e2b684714cb1acc19da5492">resource_limits_manager::add_pending_ram_usage</a>( <span class="keyword">const</span> <a class="code" href="structeosio_1_1chain_1_1name.html">account_name</a> account, int64_t ram_delta ) {</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;   <span class="keywordflow">if</span> (ram_delta == 0) {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;   }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; usage  = _db.get&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>,by_owner&gt;( account );</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;   <a class="code" href="exceptions_8hpp_a2cb5d7112457a24df46ffcd923270e16.html#a2cb5d7112457a24df46ffcd923270e16">EOS_ASSERT</a>( ram_delta &lt;= 0 || UINT64_MAX - usage.ram_usage &gt;= (uint64_t)ram_delta, <a class="code" href="namespaceeosio_1_1chain_ad6e015097a10f08028a3e3df3b17ecdf.html#ad6e015097a10f08028a3e3df3b17ecdf">transaction_exception</a>,</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;              <span class="stringliteral">&quot;Ram usage delta would overflow UINT64_MAX&quot;</span>);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;   <a class="code" href="exceptions_8hpp_a2cb5d7112457a24df46ffcd923270e16.html#a2cb5d7112457a24df46ffcd923270e16">EOS_ASSERT</a>(ram_delta &gt;= 0 || usage.ram_usage &gt;= (uint64_t)(-ram_delta), <a class="code" href="namespaceeosio_1_1chain_ad6e015097a10f08028a3e3df3b17ecdf.html#ad6e015097a10f08028a3e3df3b17ecdf">transaction_exception</a>,</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;              <span class="stringliteral">&quot;Ram usage delta would underflow UINT64_MAX&quot;</span>);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;   _db.modify( usage, [&amp;]( <span class="keyword">auto</span>&amp; u ) {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;     u.ram_usage += ram_delta;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;   });</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;}</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a0e777aedcff5772d317ff6b56c7b655b.html#a0e777aedcff5772d317ff6b56c7b655b">  177</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a0e777aedcff5772d317ff6b56c7b655b.html#a0e777aedcff5772d317ff6b56c7b655b">resource_limits_manager::verify_account_ram_usage</a>( <span class="keyword">const</span> <a class="code" href="structeosio_1_1chain_1_1name.html">account_name</a> account )<span class="keyword">const </span>{</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;   int64_t ram_bytes; int64_t net_weight; int64_t cpu_weight;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;   <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a39d7f523fa141beefd266c031db80322.html#a39d7f523fa141beefd266c031db80322">get_account_limits</a>( account, ram_bytes, net_weight, cpu_weight );</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; usage  = _db.get&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>,by_owner&gt;( account );</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;   <span class="keywordflow">if</span>( ram_bytes &gt;= 0 ) {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <a class="code" href="exceptions_8hpp_a2cb5d7112457a24df46ffcd923270e16.html#a2cb5d7112457a24df46ffcd923270e16">EOS_ASSERT</a>( usage.ram_usage &lt;= ram_bytes, ram_usage_exceeded,</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                  <span class="stringliteral">&quot;account ${account} has insufficient ram; needs ${needs} bytes has ${available} bytes&quot;</span>,</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                  (<span class="stringliteral">&quot;account&quot;</span>, account)(<span class="stringliteral">&quot;needs&quot;</span>,usage.ram_usage)(<span class="stringliteral">&quot;available&quot;</span>,ram_bytes)              );</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;   }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;}</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a343929ff1ba20582fb847fd17282a6ee.html#a343929ff1ba20582fb847fd17282a6ee">  189</a></span>&#160;int64_t <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a343929ff1ba20582fb847fd17282a6ee.html#a343929ff1ba20582fb847fd17282a6ee">resource_limits_manager::get_account_ram_usage</a>( <span class="keyword">const</span> <a class="code" href="structeosio_1_1chain_1_1name.html">account_name</a>&amp; <a class="code" href="structeosio_1_1chain_1_1name.html">name</a> )<span class="keyword">const </span>{</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;   <span class="keywordflow">return</span> _db.get&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>,by_owner&gt;( <a class="code" href="structeosio_1_1chain_1_1name.html">name</a> ).ram_usage;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;}</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_aa141ccc9385296bc379d9cddab5e9a41.html#aa141ccc9385296bc379d9cddab5e9a41">  194</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_aa141ccc9385296bc379d9cddab5e9a41.html#aa141ccc9385296bc379d9cddab5e9a41">resource_limits_manager::set_account_limits</a>( <span class="keyword">const</span> <a class="code" href="structeosio_1_1chain_1_1name.html">account_name</a>&amp; account, int64_t ram_bytes, int64_t net_weight, int64_t cpu_weight) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   <span class="comment">//const auto&amp; usage = _db.get&lt;resource_usage_object,by_owner&gt;( account );</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">    * Since we need to delay these until the next resource limiting boundary, these are created in a &quot;pending&quot;</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">    * state or adjusted in an existing &quot;pending&quot; state.  The chain controller will collapse &quot;pending&quot; state into</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">    * the actual state at the next appropriate boundary.</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;   <span class="keyword">auto</span> find_or_create_pending_limits = [&amp;]() -&gt; <span class="keyword">const</span> <a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>&amp; {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>* pending_limits = _db.find&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>, by_owner&gt;( boost::make_tuple(<span class="keyword">true</span>, account) );</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordflow">if</span> (pending_limits == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;         <span class="keyword">const</span> <span class="keyword">auto</span>&amp; limits = _db.get&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>, by_owner&gt;( boost::make_tuple(<span class="keyword">false</span>, account));</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;         <span class="keywordflow">return</span> _db.create&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>&gt;([&amp;](<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>&amp; pending_limits){</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            pending_limits.owner = limits.owner;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            pending_limits.ram_bytes = limits.ram_bytes;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            pending_limits.net_weight = limits.net_weight;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            pending_limits.cpu_weight = limits.cpu_weight;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            pending_limits.pending = <span class="keyword">true</span>;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;         });</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;         <span class="keywordflow">return</span> *pending_limits;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;   };</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;   <span class="comment">// update the users weights directly</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;   <span class="keyword">auto</span>&amp; limits = find_or_create_pending_limits();</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;   <span class="keywordtype">bool</span> decreased_limit = <span class="keyword">false</span>;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;   <span class="keywordflow">if</span>( ram_bytes &gt;= 0 ) {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      decreased_limit = ( (limits.ram_bytes &lt; 0) || (ram_bytes &lt; limits.ram_bytes) );</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">      if( limits.ram_bytes &lt; 0 ) {</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">         EOS_ASSERT(ram_bytes &gt;= usage.ram_usage, wasm_execution_error, &quot;converting unlimited account would result in overcommitment [commit=${c}, desired limit=${l}]&quot;, (&quot;c&quot;, usage.ram_usage)(&quot;l&quot;, ram_bytes));</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">      } else {</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">         EOS_ASSERT(ram_bytes &gt;= usage.ram_usage, wasm_execution_error, &quot;attempting to release committed ram resources [commit=${c}, desired limit=${l}]&quot;, (&quot;c&quot;, usage.ram_usage)(&quot;l&quot;, ram_bytes));</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">      }</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;   }</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;   <span class="keyword">auto</span> old_ram_bytes = limits.ram_bytes;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;   _db.modify( limits, [&amp;]( <a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>&amp; pending_limits ){</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      pending_limits.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object_a64e5b59d9bcc340bea767871cc3dcc20.html#a64e5b59d9bcc340bea767871cc3dcc20">ram_bytes</a> = ram_bytes;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      pending_limits.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object_ae8b6761b8c2eb5ff544b911f3d1c80c6.html#ae8b6761b8c2eb5ff544b911f3d1c80c6">net_weight</a> = net_weight;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      pending_limits.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object_afc96bc9a6d217487661c774af2e2ba0d.html#afc96bc9a6d217487661c774af2e2ba0d">cpu_weight</a> = cpu_weight;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;   });</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;   <span class="keywordflow">return</span> decreased_limit;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;}</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a39d7f523fa141beefd266c031db80322.html#a39d7f523fa141beefd266c031db80322">  245</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a39d7f523fa141beefd266c031db80322.html#a39d7f523fa141beefd266c031db80322">resource_limits_manager::get_account_limits</a>( <span class="keyword">const</span> <a class="code" href="structeosio_1_1chain_1_1name.html">account_name</a>&amp; account, int64_t&amp; ram_bytes, int64_t&amp; net_weight, int64_t&amp; cpu_weight )<span class="keyword"> const </span>{</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>* pending_buo = _db.find&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>,by_owner&gt;( boost::make_tuple(<span class="keyword">true</span>, account) );</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;   <span class="keywordflow">if</span> (pending_buo) {</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      ram_bytes  = pending_buo-&gt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object_a64e5b59d9bcc340bea767871cc3dcc20.html#a64e5b59d9bcc340bea767871cc3dcc20">ram_bytes</a>;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      net_weight = pending_buo-&gt;net_weight;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      cpu_weight = pending_buo-&gt;cpu_weight;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; buo = _db.get&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>,by_owner&gt;( boost::make_tuple( <span class="keyword">false</span>, account ) );</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      ram_bytes  = buo.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object_a64e5b59d9bcc340bea767871cc3dcc20.html#a64e5b59d9bcc340bea767871cc3dcc20">ram_bytes</a>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      net_weight = buo.net_weight;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      cpu_weight = buo.cpu_weight;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;   }</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;}</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_af6e815c0017ace48c36ade09be544d52.html#af6e815c0017ace48c36ade09be544d52">  260</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_af6e815c0017ace48c36ade09be544d52.html#af6e815c0017ace48c36ade09be544d52">resource_limits_manager::process_account_limit_updates</a>() {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;   <span class="keyword">auto</span>&amp; multi_index = _db.get_mutable_index&lt;<a class="code" href="namespaceeosio_1_1chain_1_1resource__limits_a5118123f745056c6e5112c6abf938428.html#a5118123f745056c6e5112c6abf938428">resource_limits_index</a>&gt;();</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;   <span class="keyword">auto</span>&amp; by_owner_index = multi_index.indices().get&lt;by_owner&gt;();</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;   <span class="comment">// convenience local lambda to reduce clutter</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;   <span class="keyword">auto</span> update_state_and_value = [](uint64_t &amp;total, int64_t &amp;value, int64_t pending_value, <span class="keyword">const</span> <span class="keywordtype">char</span>* debug_which) -&gt; <span class="keywordtype">void</span> {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <span class="keywordflow">if</span> (value &gt; 0) {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;         <a class="code" href="exceptions_8hpp_a2cb5d7112457a24df46ffcd923270e16.html#a2cb5d7112457a24df46ffcd923270e16">EOS_ASSERT</a>(total &gt;= value, rate_limiting_state_inconsistent, <span class="stringliteral">&quot;underflow when reverting old value to ${which}&quot;</span>, (<span class="stringliteral">&quot;which&quot;</span>, debug_which));</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;         total -= value;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      }</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <span class="keywordflow">if</span> (pending_value &gt; 0) {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;         <a class="code" href="exceptions_8hpp_a2cb5d7112457a24df46ffcd923270e16.html#a2cb5d7112457a24df46ffcd923270e16">EOS_ASSERT</a>(UINT64_MAX - total &gt;= pending_value, rate_limiting_state_inconsistent, <span class="stringliteral">&quot;overflow when applying new value to ${which}&quot;</span>, (<span class="stringliteral">&quot;which&quot;</span>, debug_which));</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;         total += pending_value;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      value = pending_value;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;   };</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; state = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   _db.modify(state, [&amp;](<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&amp; rso){</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordflow">while</span>(!by_owner_index.empty()) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;         <span class="keyword">const</span> <span class="keyword">auto</span>&amp; itr = by_owner_index.lower_bound(boost::make_tuple(<span class="keyword">true</span>));</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;         <span class="keywordflow">if</span> (itr == by_owner_index.end() || itr-&gt;pending!= <span class="keyword">true</span>) {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;         }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;         <span class="keyword">const</span> <span class="keyword">auto</span>&amp; actual_entry = _db.get&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>, by_owner&gt;(boost::make_tuple(<span class="keyword">false</span>, itr-&gt;owner));</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;         _db.modify(actual_entry, [&amp;](<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>&amp; rlo){</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            update_state_and_value(rso.total_ram_bytes,  rlo.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object_a64e5b59d9bcc340bea767871cc3dcc20.html#a64e5b59d9bcc340bea767871cc3dcc20">ram_bytes</a>,  itr-&gt;ram_bytes, <span class="stringliteral">&quot;ram_bytes&quot;</span>);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            update_state_and_value(rso.total_cpu_weight, rlo.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object_afc96bc9a6d217487661c774af2e2ba0d.html#afc96bc9a6d217487661c774af2e2ba0d">cpu_weight</a>, itr-&gt;cpu_weight, <span class="stringliteral">&quot;cpu_weight&quot;</span>);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            update_state_and_value(rso.total_net_weight, rlo.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object_ae8b6761b8c2eb5ff544b911f3d1c80c6.html#ae8b6761b8c2eb5ff544b911f3d1c80c6">net_weight</a>, itr-&gt;net_weight, <span class="stringliteral">&quot;net_weight&quot;</span>);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;         });</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;         multi_index.remove(*itr);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;   });</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;}</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a5921deb0de6b3a28fe7f6b6d11170abc.html#a5921deb0de6b3a28fe7f6b6d11170abc">  299</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a5921deb0de6b3a28fe7f6b6d11170abc.html#a5921deb0de6b3a28fe7f6b6d11170abc">resource_limits_manager::process_block_usage</a>(uint32_t block_num) {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; s = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; config = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;   _db.modify(s, [&amp;](<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&amp; state){</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="comment">// apply pending usage, update virtual limits and reset the pending</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      state.average_block_cpu_usage.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1impl_1_1exponential__moving__average__accumulator_a8dbbc4c8adcb983a76255615067c7536.html#a8dbbc4c8adcb983a76255615067c7536">add</a>(state.pending_cpu_usage, block_num, config.cpu_limit_parameters.periods);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      state.update_virtual_cpu_limit(config);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      state.pending_cpu_usage = 0;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      state.average_block_net_usage.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1impl_1_1exponential__moving__average__accumulator_a8dbbc4c8adcb983a76255615067c7536.html#a8dbbc4c8adcb983a76255615067c7536">add</a>(state.pending_net_usage, block_num, config.net_limit_parameters.periods);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      state.update_virtual_net_limit(config);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      state.pending_net_usage = 0;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;   });</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;}</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ac43c8d05c82baa94fe5d571e0b22f94a.html#ac43c8d05c82baa94fe5d571e0b22f94a">  317</a></span>&#160;uint64_t <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ac43c8d05c82baa94fe5d571e0b22f94a.html#ac43c8d05c82baa94fe5d571e0b22f94a">resource_limits_manager::get_virtual_block_cpu_limit</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; state = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;   <span class="keywordflow">return</span> state.virtual_cpu_limit;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;}</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_aad01f3a0d7e30f2403130192717ca9c1.html#aad01f3a0d7e30f2403130192717ca9c1">  322</a></span>&#160;uint64_t <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_aad01f3a0d7e30f2403130192717ca9c1.html#aad01f3a0d7e30f2403130192717ca9c1">resource_limits_manager::get_virtual_block_net_limit</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; state = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;   <span class="keywordflow">return</span> state.virtual_net_limit;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;}</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ad34b0f0ddb1d0f4594344f781dc18469.html#ad34b0f0ddb1d0f4594344f781dc18469">  327</a></span>&#160;uint64_t <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ad34b0f0ddb1d0f4594344f781dc18469.html#ad34b0f0ddb1d0f4594344f781dc18469">resource_limits_manager::get_block_cpu_limit</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; state = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; config = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;   <span class="keywordflow">return</span> config.cpu_limit_parameters.max - state.pending_cpu_usage;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;}</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a2e43b175307eea1efbb9ad28f734cce2.html#a2e43b175307eea1efbb9ad28f734cce2">  333</a></span>&#160;uint64_t <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a2e43b175307eea1efbb9ad28f734cce2.html#a2e43b175307eea1efbb9ad28f734cce2">resource_limits_manager::get_block_net_limit</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; state = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; config = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   <span class="keywordflow">return</span> config.net_limit_parameters.max - state.pending_net_usage;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;}</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a2fa3eb03e5f6ed8988aea9cb19688d97.html#a2fa3eb03e5f6ed8988aea9cb19688d97">  339</a></span>&#160;int64_t <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a2fa3eb03e5f6ed8988aea9cb19688d97.html#a2fa3eb03e5f6ed8988aea9cb19688d97">resource_limits_manager::get_account_cpu_limit</a>( <span class="keyword">const</span> <a class="code" href="structeosio_1_1chain_1_1name.html">account_name</a>&amp; <a class="code" href="structeosio_1_1chain_1_1name.html">name</a> )<span class="keyword"> const </span>{</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; state = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; usage = _db.get&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>, by_owner&gt;(<a class="code" href="structeosio_1_1chain_1_1name.html">name</a>);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; config = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;   int64_t unused;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;   int64_t cpu_weight;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;   <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a39d7f523fa141beefd266c031db80322.html#a39d7f523fa141beefd266c031db80322">get_account_limits</a>( <a class="code" href="structeosio_1_1chain_1_1name.html">name</a>, unused, unused, cpu_weight );</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;   <span class="keywordflow">if</span>( cpu_weight &lt; 0 || state.total_cpu_weight == 0 ) {</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;   }</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> window_size = config.account_cpu_usage_average_window;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;   <span class="keyword">auto</span> virtual_cpu_capacity_in_window = state.virtual_cpu_limit * window_size;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;   <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> user_weight     = cpu_weight;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;   <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> all_user_weight = state.total_cpu_weight;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;   <span class="keyword">auto</span> max_user_use_in_window = (virtual_cpu_capacity_in_window * user_weight) / all_user_weight;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;   <span class="keyword">auto</span> cpu_used_in_window  = (usage.cpu_usage.value_ex * window_size) / config::rate_limiting_precision;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;   <span class="keywordflow">if</span>( max_user_use_in_window &lt;= cpu_used_in_window ) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;   <span class="keywordflow">return</span> max_user_use_in_window - cpu_used_in_window;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">   const auto&amp; state = _db.get&lt;resource_limits_state_object&gt;();</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">   const auto&amp; usage = _db.get&lt;resource_usage_object, by_owner&gt;(name);</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">   int64_t x;</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">   int64_t cpu_weight;</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">   get_account_limits( name, x, x, cpu_weight );</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">   if( cpu_weight &lt; 0 ) {</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">      return -1;</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">   }</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">   auto total_cpu_weight = state.total_cpu_weight;</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">   if( total_cpu_weight == 0 ) total_cpu_weight = 1;</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">   uint128_t consumed_ex = (uint128_t)usage.cpu_usage.consumed * (uint128_t)config::rate_limiting_precision;</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">   uint128_t virtual_capacity_ex = (uint128_t)state.virtual_cpu_limit * (uint128_t)config::rate_limiting_precision;</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">   uint128_t usable_capacity_ex = (uint128_t)(virtual_capacity_ex * cpu_weight) / (uint128_t)total_cpu_weight;</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">   if( usable_capacity_ex &lt; consumed_ex ) {</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">      return 0;</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">   }</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">   return (int64_t)((usable_capacity_ex - consumed_ex) / (uint128_t)config::rate_limiting_precision);</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;}</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a788be6a433bd9dd35ac8b166e22d5aa0.html#a788be6a433bd9dd35ac8b166e22d5aa0">  394</a></span>&#160;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit.html">account_resource_limit</a> <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a788be6a433bd9dd35ac8b166e22d5aa0.html#a788be6a433bd9dd35ac8b166e22d5aa0">resource_limits_manager::get_account_cpu_limit_ex</a>( <span class="keyword">const</span> <a class="code" href="structeosio_1_1chain_1_1name.html">account_name</a>&amp; <a class="code" href="structeosio_1_1chain_1_1name.html">name</a> )<span class="keyword"> const </span>{</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; config = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; state = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; usage = _db.get&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>, by_owner&gt;(<a class="code" href="structeosio_1_1chain_1_1name.html">name</a>);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;   int64_t cpu_weight, x, y;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;   <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a39d7f523fa141beefd266c031db80322.html#a39d7f523fa141beefd266c031db80322">get_account_limits</a>( <a class="code" href="structeosio_1_1chain_1_1name.html">name</a>, x, y, cpu_weight );</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;   <span class="keywordflow">if</span>( cpu_weight &lt; 0 || state.total_cpu_weight == 0 ) {</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="keywordflow">return</span> { -1, -1, -1 };</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;   }</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;   <a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit.html">account_resource_limit</a> arl;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;   <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> window_size = config.account_cpu_usage_average_window;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;   <span class="keyword">auto</span> virtual_cpu_capacity_in_window = state.virtual_cpu_limit * window_size;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;   <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> user_weight     = cpu_weight;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;   <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> all_user_weight = state.total_cpu_weight;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;   <span class="keyword">auto</span> max_user_use_in_window = (<a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a>(virtual_cpu_capacity_in_window) * user_weight) / all_user_weight;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;   <span class="keyword">auto</span> cpu_used_in_window  = (usage.cpu_usage.value_ex * window_size) / config::rate_limiting_precision;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;   <span class="keywordflow">if</span>( max_user_use_in_window &lt;= cpu_used_in_window )</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      arl.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit_a57d8620b60978d073729d0ae95897da9.html#a57d8620b60978d073729d0ae95897da9">available</a> = 0;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      arl.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit_a57d8620b60978d073729d0ae95897da9.html#a57d8620b60978d073729d0ae95897da9">available</a> = max_user_use_in_window - cpu_used_in_window;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;   arl.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit_a86dc68833c2e9bc6c64288267a2ba0d8.html#a86dc68833c2e9bc6c64288267a2ba0d8">used</a> = cpu_used_in_window;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;   arl.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit_ad8074b78fd173ff727be2d1425cdd8bd.html#ad8074b78fd173ff727be2d1425cdd8bd">max</a> = max_user_use_in_window;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;   <span class="keywordflow">return</span> arl;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;}</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a09ba3c8d161050ade37c6e8b213b66e0.html#a09ba3c8d161050ade37c6e8b213b66e0">  428</a></span>&#160;int64_t <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a09ba3c8d161050ade37c6e8b213b66e0.html#a09ba3c8d161050ade37c6e8b213b66e0">resource_limits_manager::get_account_net_limit</a>( <span class="keyword">const</span> <a class="code" href="structeosio_1_1chain_1_1name.html">account_name</a>&amp; <a class="code" href="structeosio_1_1chain_1_1name.html">name</a> )<span class="keyword"> const </span>{</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; state = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; usage = _db.get&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>, by_owner&gt;(<a class="code" href="structeosio_1_1chain_1_1name.html">name</a>);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; config = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;   int64_t unused;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;   int64_t net_weight;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;   <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a39d7f523fa141beefd266c031db80322.html#a39d7f523fa141beefd266c031db80322">get_account_limits</a>( <a class="code" href="structeosio_1_1chain_1_1name.html">name</a>, unused, net_weight, unused );</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;   <span class="keywordflow">if</span>( net_weight &lt; 0 || state.total_net_weight == 0 ) {</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;   }</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;   <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> window_size = config.account_net_usage_average_window;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;   <span class="keyword">auto</span> virtual_network_capacity_in_window = state.virtual_net_limit * window_size;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;   <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> user_weight     = net_weight;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;   <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> all_user_weight = state.total_net_weight;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;   <span class="keyword">auto</span> max_user_use_in_window = (virtual_network_capacity_in_window * user_weight) / all_user_weight;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;   <span class="keyword">auto</span> net_used_in_window  = (usage.net_usage.value_ex * window_size) / config::rate_limiting_precision;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;   <span class="keywordflow">if</span>( max_user_use_in_window &lt;= net_used_in_window ) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;   <span class="keywordflow">return</span> max_user_use_in_window - net_used_in_window;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;}</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno"><a class="line" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a3c537f541c33ac87ac8878002512c516.html#a3c537f541c33ac87ac8878002512c516">  455</a></span>&#160;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit.html">account_resource_limit</a> <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a3c537f541c33ac87ac8878002512c516.html#a3c537f541c33ac87ac8878002512c516">resource_limits_manager::get_account_net_limit_ex</a>( <span class="keyword">const</span> <a class="code" href="structeosio_1_1chain_1_1name.html">account_name</a>&amp; <a class="code" href="structeosio_1_1chain_1_1name.html">name</a> )<span class="keyword"> const </span>{</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; config = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; state  = _db.get&lt;<a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; usage  = _db.get&lt;<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>, by_owner&gt;(<a class="code" href="structeosio_1_1chain_1_1name.html">name</a>);</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;   int64_t net_weight, x, y;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;   <a class="code" href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a39d7f523fa141beefd266c031db80322.html#a39d7f523fa141beefd266c031db80322">get_account_limits</a>( <a class="code" href="structeosio_1_1chain_1_1name.html">name</a>, x, net_weight, y );</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;   <span class="keywordflow">if</span>( net_weight &lt; 0 || state.total_net_weight == 0) {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="keywordflow">return</span> { -1, -1, -1 };</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;   }</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;   <a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit.html">account_resource_limit</a> arl;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;   <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> window_size = config.account_net_usage_average_window;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;   <span class="keyword">auto</span> virtual_network_capacity_in_window = state.virtual_net_limit * window_size;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;   <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> user_weight     = net_weight;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;   <a class="code" href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">uint128_t</a> all_user_weight = state.total_net_weight;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;   <span class="keyword">auto</span> max_user_use_in_window = (virtual_network_capacity_in_window * user_weight) / all_user_weight;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;   <span class="keyword">auto</span> net_used_in_window  = (usage.net_usage.value_ex * window_size) / config::rate_limiting_precision;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;   <span class="keywordflow">if</span>( max_user_use_in_window &lt;= net_used_in_window )</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      arl.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit_a57d8620b60978d073729d0ae95897da9.html#a57d8620b60978d073729d0ae95897da9">available</a> = 0;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      arl.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit_a57d8620b60978d073729d0ae95897da9.html#a57d8620b60978d073729d0ae95897da9">available</a> = max_user_use_in_window - net_used_in_window;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;   arl.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit_a86dc68833c2e9bc6c64288267a2ba0d8.html#a86dc68833c2e9bc6c64288267a2ba0d8">used</a> = net_used_in_window;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;   arl.<a class="code" href="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit_ad8074b78fd173ff727be2d1425cdd8bd.html#ad8074b78fd173ff727be2d1425cdd8bd">max</a> = max_user_use_in_window;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;   <span class="keywordflow">return</span> arl;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;}</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;} } } </div><div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object_afc96bc9a6d217487661c774af2e2ba0d_html_afc96bc9a6d217487661c774af2e2ba0d"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object_afc96bc9a6d217487661c774af2e2ba0d.html#afc96bc9a6d217487661c774af2e2ba0d">eosio::chain::resource_limits::resource_limits_object::cpu_weight</a></div><div class="ttdeci">int64_t cpu_weight</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits__private_8hpp_source.html#l00105">resource_limits_private.hpp:105</a></div></div>
<div class="ttc" id="namespaceeosio_1_1chain_1_1resource__limits_ac065b1ca4a1b36442cc4da7ab645ff77_html_ac065b1ca4a1b36442cc4da7ab645ff77"><div class="ttname"><a href="namespaceeosio_1_1chain_1_1resource__limits_ac065b1ca4a1b36442cc4da7ab645ff77.html#ac065b1ca4a1b36442cc4da7ab645ff77">eosio::chain::resource_limits::resource_limits_config_index</a></div><div class="ttdeci">chainbase::shared_multi_index_container&lt; resource_limits_config_object, indexed_by&lt; ordered_unique&lt; tag&lt; by_id &gt;, member&lt; resource_limits_config_object, resource_limits_config_object::id_type, &amp;resource_limits_config_object::id &gt; &gt; &gt; &gt; resource_limits_config_index</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits__private_8hpp_source.html#l00169">resource_limits_private.hpp:169</a></div></div>
<div class="ttc" id="namespaceeosio_html"><div class="ttname"><a href="namespaceeosio.html">eosio</a></div><div class="ttdef"><b>Definition:</b> <a href="abi__serializer_8cpp_source.html#l00017">abi_serializer.cpp:17</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_a91a58a56b53c661d3415718ddbf70590_html_a91a58a56b53c661d3415718ddbf70590"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_a91a58a56b53c661d3415718ddbf70590.html#a91a58a56b53c661d3415718ddbf70590">eosio::chain::resource_limits::elastic_limit_parameters::periods</a></div><div class="ttdeci">uint32_t periods</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8hpp_source.html#l00020">resource_limits.hpp:20</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_aad01f3a0d7e30f2403130192717ca9c1_html_aad01f3a0d7e30f2403130192717ca9c1"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_aad01f3a0d7e30f2403130192717ca9c1.html#aad01f3a0d7e30f2403130192717ca9c1">eosio::chain::resource_limits::resource_limits_manager::get_virtual_block_net_limit</a></div><div class="ttdeci">uint64_t get_virtual_block_net_limit() const</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00322">resource_limits.cpp:322</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_aa141ccc9385296bc379d9cddab5e9a41_html_aa141ccc9385296bc379d9cddab5e9a41"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_aa141ccc9385296bc379d9cddab5e9a41.html#aa141ccc9385296bc379d9cddab5e9a41">eosio::chain::resource_limits::resource_limits_manager::set_account_limits</a></div><div class="ttdeci">bool set_account_limits(const account_name &amp;account, int64_t ram_bytes, int64_t net_weight, int64_t cpu_weight)</div><div class="ttdoc">set_account_limits returns true if new ram_bytes limit is more restrictive than the previously set on...</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00194">resource_limits.cpp:194</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a35a91a5e0e990a9f1a02c7c996ec58d4_html_a35a91a5e0e990a9f1a02c7c996ec58d4"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a35a91a5e0e990a9f1a02c7c996ec58d4.html#a35a91a5e0e990a9f1a02c7c996ec58d4">eosio::chain::resource_limits::resource_limits_manager::update_account_usage</a></div><div class="ttdeci">void update_account_usage(const flat_set&lt; account_name &gt; &amp;accounts, uint32_t ordinal)</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00082">resource_limits.cpp:82</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a09ba3c8d161050ade37c6e8b213b66e0_html_a09ba3c8d161050ade37c6e8b213b66e0"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a09ba3c8d161050ade37c6e8b213b66e0.html#a09ba3c8d161050ade37c6e8b213b66e0">eosio::chain::resource_limits::resource_limits_manager::get_account_net_limit</a></div><div class="ttdeci">int64_t get_account_net_limit(const account_name &amp;name) const</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00428">resource_limits.cpp:428</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object_html"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">eosio::chain::resource_limits::resource_limits_object</a></div><div class="ttdef"><b>Definition:</b> <a href="resource__limits__private_8hpp_source.html#l00096">resource_limits_private.hpp:96</a></div></div>
<div class="ttc" id="exceptions_8hpp_html"><div class="ttname"><a href="exceptions_8hpp.html">exceptions.hpp</a></div></div>
<div class="ttc" id="transaction__metadata_8hpp_html"><div class="ttname"><a href="transaction__metadata_8hpp.html">transaction_metadata.hpp</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a2fa3eb03e5f6ed8988aea9cb19688d97_html_a2fa3eb03e5f6ed8988aea9cb19688d97"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a2fa3eb03e5f6ed8988aea9cb19688d97.html#a2fa3eb03e5f6ed8988aea9cb19688d97">eosio::chain::resource_limits::resource_limits_manager::get_account_cpu_limit</a></div><div class="ttdeci">int64_t get_account_cpu_limit(const account_name &amp;name) const</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00339">resource_limits.cpp:339</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a221e58d79e2b684714cb1acc19da5492_html_a221e58d79e2b684714cb1acc19da5492"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a221e58d79e2b684714cb1acc19da5492.html#a221e58d79e2b684714cb1acc19da5492">eosio::chain::resource_limits::resource_limits_manager::add_pending_ram_usage</a></div><div class="ttdeci">void add_pending_ram_usage(const account_name account, int64_t ram_delta)</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00160">resource_limits.cpp:160</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object_a64e5b59d9bcc340bea767871cc3dcc20_html_a64e5b59d9bcc340bea767871cc3dcc20"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object_a64e5b59d9bcc340bea767871cc3dcc20.html#a64e5b59d9bcc340bea767871cc3dcc20">eosio::chain::resource_limits::resource_limits_object::ram_bytes</a></div><div class="ttdeci">int64_t ram_bytes</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits__private_8hpp_source.html#l00106">resource_limits_private.hpp:106</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object_html"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">eosio::chain::resource_limits::resource_limits_state_object</a></div><div class="ttdef"><b>Definition:</b> <a href="resource__limits__private_8hpp_source.html#l00171">resource_limits_private.hpp:171</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object_ae8b6761b8c2eb5ff544b911f3d1c80c6_html_ae8b6761b8c2eb5ff544b911f3d1c80c6"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1resource__limits__object_ae8b6761b8c2eb5ff544b911f3d1c80c6.html#ae8b6761b8c2eb5ff544b911f3d1c80c6">eosio::chain::resource_limits::resource_limits_object::net_weight</a></div><div class="ttdeci">int64_t net_weight</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits__private_8hpp_source.html#l00104">resource_limits_private.hpp:104</a></div></div>
<div class="ttc" id="transaction_8hpp_html"><div class="ttname"><a href="transaction_8hpp.html">transaction.hpp</a></div></div>
<div class="ttc" id="namespaceeosio_1_1chain_1_1resource__limits_ab61fbfbc70031ab9867143d6fb6cc168_html_ab61fbfbc70031ab9867143d6fb6cc168"><div class="ttname"><a href="namespaceeosio_1_1chain_1_1resource__limits_ab61fbfbc70031ab9867143d6fb6cc168.html#ab61fbfbc70031ab9867143d6fb6cc168">eosio::chain::resource_limits::resource_limits_state_index</a></div><div class="ttdeci">chainbase::shared_multi_index_container&lt; resource_limits_state_object, indexed_by&lt; ordered_unique&lt; tag&lt; by_id &gt;, member&lt; resource_limits_state_object, resource_limits_state_object::id_type, &amp;resource_limits_state_object::id &gt; &gt; &gt; &gt; resource_limits_state_index</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits__private_8hpp_source.html#l00224">resource_limits_private.hpp:224</a></div></div>
<div class="ttc" id="resource__limits_8hpp_html"><div class="ttname"><a href="resource__limits_8hpp.html">resource_limits.hpp</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ae23ed59666148549091ebb2b8d47922c_html_ae23ed59666148549091ebb2b8d47922c"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ae23ed59666148549091ebb2b8d47922c.html#ae23ed59666148549091ebb2b8d47922c">eosio::chain::resource_limits::resource_limits_manager::set_block_parameters</a></div><div class="ttdeci">void set_block_parameters(const elastic_limit_parameters &amp;cpu_limit_parameters, const elastic_limit_parameters &amp;net_limit_parameters)</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00072">resource_limits.cpp:72</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a788be6a433bd9dd35ac8b166e22d5aa0_html_a788be6a433bd9dd35ac8b166e22d5aa0"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a788be6a433bd9dd35ac8b166e22d5aa0.html#a788be6a433bd9dd35ac8b166e22d5aa0">eosio::chain::resource_limits::resource_limits_manager::get_account_cpu_limit_ex</a></div><div class="ttdeci">account_resource_limit get_account_cpu_limit_ex(const account_name &amp;name) const</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00394">resource_limits.cpp:394</a></div></div>
<div class="ttc" id="namespaceeosio_1_1chain_1_1resource__limits_a1a12778be310d2a726ef83c22904f1d0_html_a1a12778be310d2a726ef83c22904f1d0"><div class="ttname"><a href="namespaceeosio_1_1chain_1_1resource__limits_a1a12778be310d2a726ef83c22904f1d0.html#a1a12778be310d2a726ef83c22904f1d0">eosio::chain::resource_limits::resource_usage_index</a></div><div class="ttdeci">chainbase::shared_multi_index_container&lt; resource_usage_object, indexed_by&lt; ordered_unique&lt; tag&lt; by_id &gt;, member&lt; resource_usage_object, resource_usage_object::id_type, &amp;resource_usage_object::id &gt; &gt;, ordered_unique&lt; tag&lt; by_owner &gt;, member&lt; resource_usage_object, account_name, &amp;resource_usage_object::owner &gt; &gt; &gt; &gt; resource_usage_index</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits__private_8hpp_source.html#l00144">resource_limits_private.hpp:144</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1impl_1_1exponential__moving__average__accumulator_a8dbbc4c8adcb983a76255615067c7536_html_a8dbbc4c8adcb983a76255615067c7536"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1impl_1_1exponential__moving__average__accumulator_a8dbbc4c8adcb983a76255615067c7536.html#a8dbbc4c8adcb983a76255615067c7536">eosio::chain::resource_limits::impl::exponential_moving_average_accumulator::add</a></div><div class="ttdeci">void add(uint64_t units, uint32_t ordinal, uint32_t window_size)</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits__private_8hpp_source.html#l00056">resource_limits_private.hpp:56</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a3c537f541c33ac87ac8878002512c516_html_a3c537f541c33ac87ac8878002512c516"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a3c537f541c33ac87ac8878002512c516.html#a3c537f541c33ac87ac8878002512c516">eosio::chain::resource_limits::resource_limits_manager::get_account_net_limit_ex</a></div><div class="ttdeci">account_resource_limit get_account_net_limit_ex(const account_name &amp;name) const</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00455">resource_limits.cpp:455</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_ad8118fb8df0d8f14392e7b5f0972fe39_html_ad8118fb8df0d8f14392e7b5f0972fe39"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_ad8118fb8df0d8f14392e7b5f0972fe39.html#ad8118fb8df0d8f14392e7b5f0972fe39">eosio::chain::resource_limits::elastic_limit_parameters::contract_rate</a></div><div class="ttdeci">ratio contract_rate</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8hpp_source.html#l00023">resource_limits.hpp:23</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a20d3da9fa3e3c322db28670d4f2e589b_html_a20d3da9fa3e3c322db28670d4f2e589b"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a20d3da9fa3e3c322db28670d4f2e589b.html#a20d3da9fa3e3c322db28670d4f2e589b">eosio::chain::resource_limits::resource_limits_manager::initialize_database</a></div><div class="ttdeci">void initialize_database()</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00048">resource_limits.cpp:48</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit_a86dc68833c2e9bc6c64288267a2ba0d8_html_a86dc68833c2e9bc6c64288267a2ba0d8"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit_a86dc68833c2e9bc6c64288267a2ba0d8.html#a86dc68833c2e9bc6c64288267a2ba0d8">eosio::chain::resource_limits::account_resource_limit::used</a></div><div class="ttdeci">int64_t used</div><div class="ttdoc">quantity used in current window </div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8hpp_source.html#l00030">resource_limits.hpp:30</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ad34b0f0ddb1d0f4594344f781dc18469_html_ad34b0f0ddb1d0f4594344f781dc18469"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ad34b0f0ddb1d0f4594344f781dc18469.html#ad34b0f0ddb1d0f4594344f781dc18469">eosio::chain::resource_limits::resource_limits_manager::get_block_cpu_limit</a></div><div class="ttdeci">uint64_t get_block_cpu_limit() const</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00327">resource_limits.cpp:327</a></div></div>
<div class="ttc" id="exceptions_8hpp_a2cb5d7112457a24df46ffcd923270e16_html_a2cb5d7112457a24df46ffcd923270e16"><div class="ttname"><a href="exceptions_8hpp_a2cb5d7112457a24df46ffcd923270e16.html#a2cb5d7112457a24df46ffcd923270e16">EOS_ASSERT</a></div><div class="ttdeci">#define EOS_ASSERT(expr, exc_type, FORMAT,...)</div><div class="ttdef"><b>Definition:</b> <a href="exceptions_8hpp_source.html#l00012">exceptions.hpp:12</a></div></div>
<div class="ttc" id="namespaceeosio_1_1chain_ad6e015097a10f08028a3e3df3b17ecdf_html_ad6e015097a10f08028a3e3df3b17ecdf"><div class="ttname"><a href="namespaceeosio_1_1chain_ad6e015097a10f08028a3e3df3b17ecdf.html#ad6e015097a10f08028a3e3df3b17ecdf">eosio::chain::transaction_exception</a></div><div class="ttdeci">chain type exception Invalid public key Invalid authority Invalid transaction No ABI found Invalid transaction ID Invalid asset unlinkable block transaction outputs in block do not match transaction outputs from applying block shard locks in block are incorrect or mal formed block is too old to push transaction_exception</div><div class="ttdef"><b>Definition:</b> <a href="exceptions_8hpp_source.html#l00145">exceptions.hpp:145</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_af6e815c0017ace48c36ade09be544d52_html_af6e815c0017ace48c36ade09be544d52"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_af6e815c0017ace48c36ade09be544d52.html#af6e815c0017ace48c36ade09be544d52">eosio::chain::resource_limits::resource_limits_manager::process_account_limit_updates</a></div><div class="ttdeci">void process_account_limit_updates()</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00260">resource_limits.cpp:260</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_html"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html">eosio::chain::resource_limits::elastic_limit_parameters</a></div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8hpp_source.html#l00017">resource_limits.hpp:17</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a0e777aedcff5772d317ff6b56c7b655b_html_a0e777aedcff5772d317ff6b56c7b655b"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a0e777aedcff5772d317ff6b56c7b655b.html#a0e777aedcff5772d317ff6b56c7b655b">eosio::chain::resource_limits::resource_limits_manager::verify_account_ram_usage</a></div><div class="ttdeci">void verify_account_ram_usage(const account_name accunt) const</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00177">resource_limits.cpp:177</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1impl_1_1exponential__moving__average__accumulator_a26198afc99c94594bcbd626637be593d_html_a26198afc99c94594bcbd626637be593d"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1impl_1_1exponential__moving__average__accumulator_a26198afc99c94594bcbd626637be593d.html#a26198afc99c94594bcbd626637be593d">eosio::chain::resource_limits::impl::exponential_moving_average_accumulator::average</a></div><div class="ttdeci">uint64_t average() const</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits__private_8hpp_source.html#l00052">resource_limits_private.hpp:52</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit_html"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit.html">eosio::chain::resource_limits::account_resource_limit</a></div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8hpp_source.html#l00029">resource_limits.hpp:29</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a57a20fa67d4f071957bea7c5e138844b_html_a57a20fa67d4f071957bea7c5e138844b"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a57a20fa67d4f071957bea7c5e138844b.html#a57a20fa67d4f071957bea7c5e138844b">eosio::chain::resource_limits::resource_limits_manager::add_transaction_usage</a></div><div class="ttdeci">void add_transaction_usage(const flat_set&lt; account_name &gt; &amp;accounts, uint64_t cpu_usage, uint64_t net_usage, uint32_t ordinal)</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00093">resource_limits.cpp:93</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1name_html"><div class="ttname"><a href="structeosio_1_1chain_1_1name.html">eosio::chain::name</a></div><div class="ttdef"><b>Definition:</b> <a href="name_8hpp_source.html#l00042">name.hpp:42</a></div></div>
<div class="ttc" id="resource__limits__private_8hpp_html"><div class="ttname"><a href="resource__limits__private_8hpp.html">resource_limits_private.hpp</a></div></div>
<div class="ttc" id="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721_html_a7082035ec94c5379896cea7c61f6b721"><div class="ttname"><a href="namespaceeosio_1_1chain_a7082035ec94c5379896cea7c61f6b721.html#a7082035ec94c5379896cea7c61f6b721">eosio::chain::uint128_t</a></div><div class="ttdeci">unsigned __int128 uint128_t</div><div class="ttdef"><b>Definition:</b> <a href="types_8hpp_source.html#l00170">types.hpp:170</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_a280e6a4a44264c526a6e013621b47f79_html_a280e6a4a44264c526a6e013621b47f79"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_a280e6a4a44264c526a6e013621b47f79.html#a280e6a4a44264c526a6e013621b47f79">eosio::chain::resource_limits::elastic_limit_parameters::expand_rate</a></div><div class="ttdeci">ratio expand_rate</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8hpp_source.html#l00024">resource_limits.hpp:24</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a2e43b175307eea1efbb9ad28f734cce2_html_a2e43b175307eea1efbb9ad28f734cce2"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a2e43b175307eea1efbb9ad28f734cce2.html#a2e43b175307eea1efbb9ad28f734cce2">eosio::chain::resource_limits::resource_limits_manager::get_block_net_limit</a></div><div class="ttdeci">uint64_t get_block_net_limit() const</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00333">resource_limits.cpp:333</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ac43c8d05c82baa94fe5d571e0b22f94a_html_ac43c8d05c82baa94fe5d571e0b22f94a"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ac43c8d05c82baa94fe5d571e0b22f94a.html#ac43c8d05c82baa94fe5d571e0b22f94a">eosio::chain::resource_limits::resource_limits_manager::get_virtual_block_cpu_limit</a></div><div class="ttdeci">uint64_t get_virtual_block_cpu_limit() const</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00317">resource_limits.cpp:317</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit_a57d8620b60978d073729d0ae95897da9_html_a57d8620b60978d073729d0ae95897da9"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit_a57d8620b60978d073729d0ae95897da9.html#a57d8620b60978d073729d0ae95897da9">eosio::chain::resource_limits::account_resource_limit::available</a></div><div class="ttdeci">int64_t available</div><div class="ttdoc">quantity available in current window (based upon fractional reserve) </div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8hpp_source.html#l00031">resource_limits.hpp:31</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a343929ff1ba20582fb847fd17282a6ee_html_a343929ff1ba20582fb847fd17282a6ee"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a343929ff1ba20582fb847fd17282a6ee.html#a343929ff1ba20582fb847fd17282a6ee">eosio::chain::resource_limits::resource_limits_manager::get_account_ram_usage</a></div><div class="ttdeci">int64_t get_account_ram_usage(const account_name &amp;name) const</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00189">resource_limits.cpp:189</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a5921deb0de6b3a28fe7f6b6d11170abc_html_a5921deb0de6b3a28fe7f6b6d11170abc"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a5921deb0de6b3a28fe7f6b6d11170abc.html#a5921deb0de6b3a28fe7f6b6d11170abc">eosio::chain::resource_limits::resource_limits_manager::process_block_usage</a></div><div class="ttdeci">void process_block_usage(uint32_t block_num)</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00299">resource_limits.cpp:299</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__config__object_html"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">eosio::chain::resource_limits::resource_limits_config_object</a></div><div class="ttdef"><b>Definition:</b> <a href="resource__limits__private_8hpp_source.html#l00146">resource_limits_private.hpp:146</a></div></div>
<div class="ttc" id="namespaceeosio_1_1chain_1_1resource__limits_a5118123f745056c6e5112c6abf938428_html_a5118123f745056c6e5112c6abf938428"><div class="ttname"><a href="namespaceeosio_1_1chain_1_1resource__limits_a5118123f745056c6e5112c6abf938428.html#a5118123f745056c6e5112c6abf938428">eosio::chain::resource_limits::resource_limits_index</a></div><div class="ttdeci">chainbase::shared_multi_index_container&lt; resource_limits_object, indexed_by&lt; ordered_unique&lt; tag&lt; by_id &gt;, member&lt; resource_limits_object, resource_limits_object::id_type, &amp;resource_limits_object::id &gt; &gt;, ordered_unique&lt; tag&lt; by_owner &gt;, composite_key&lt; resource_limits_object, BOOST_MULTI_INDEX_MEMBER(resource_limits_object, bool, pending), &gt; &gt; &gt; &gt; resource_limits_index</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits__private_8hpp_source.html#l00124">resource_limits_private.hpp:124</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_a9439de3195bb5f67f8ccfe442e7d12e3_html_a9439de3195bb5f67f8ccfe442e7d12e3"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_a9439de3195bb5f67f8ccfe442e7d12e3.html#a9439de3195bb5f67f8ccfe442e7d12e3">eosio::chain::resource_limits::elastic_limit_parameters::validate</a></div><div class="ttdeci">void validate() const</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00022">resource_limits.cpp:22</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1impl_1_1ratio_a21b9ea82988a1ec7634c48bafa5daabb_html_a21b9ea82988a1ec7634c48bafa5daabb"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1impl_1_1ratio_a21b9ea82988a1ec7634c48bafa5daabb.html#a21b9ea82988a1ec7634c48bafa5daabb">eosio::chain::resource_limits::impl::ratio::denominator</a></div><div class="ttdeci">T denominator</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8hpp_source.html#l00011">resource_limits.hpp:11</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit_ad8074b78fd173ff727be2d1425cdd8bd_html_ad8074b78fd173ff727be2d1425cdd8bd"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1account__resource__limit_ad8074b78fd173ff727be2d1425cdd8bd.html#ad8074b78fd173ff727be2d1425cdd8bd">eosio::chain::resource_limits::account_resource_limit::max</a></div><div class="ttdeci">int64_t max</div><div class="ttdoc">max per window under current congestion </div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8hpp_source.html#l00032">resource_limits.hpp:32</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ae5bf9dae31e77d62b013a6590911f627_html_ae5bf9dae31e77d62b013a6590911f627"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ae5bf9dae31e77d62b013a6590911f627.html#ae5bf9dae31e77d62b013a6590911f627">eosio::chain::resource_limits::resource_limits_manager::add_indices</a></div><div class="ttdeci">void add_indices()</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00041">resource_limits.cpp:41</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a453dba43454b8498745200b37f658b26_html_a453dba43454b8498745200b37f658b26"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a453dba43454b8498745200b37f658b26.html#a453dba43454b8498745200b37f658b26">eosio::chain::resource_limits::resource_limits_manager::initialize_account</a></div><div class="ttdeci">void initialize_account(const account_name &amp;account)</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00062">resource_limits.cpp:62</a></div></div>
<div class="ttc" id="structeosio_1_1chain_1_1resource__limits_1_1resource__usage__object_html"><div class="ttname"><a href="structeosio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">eosio::chain::resource_limits::resource_usage_object</a></div><div class="ttdef"><b>Definition:</b> <a href="resource__limits__private_8hpp_source.html#l00126">resource_limits_private.hpp:126</a></div></div>
<div class="ttc" id="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a39d7f523fa141beefd266c031db80322_html_a39d7f523fa141beefd266c031db80322"><div class="ttname"><a href="classeosio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a39d7f523fa141beefd266c031db80322.html#a39d7f523fa141beefd266c031db80322">eosio::chain::resource_limits::resource_limits_manager::get_account_limits</a></div><div class="ttdeci">void get_account_limits(const account_name &amp;account, int64_t &amp;ram_bytes, int64_t &amp;net_weight, int64_t &amp;cpu_weight) const</div><div class="ttdef"><b>Definition:</b> <a href="resource__limits_8cpp_source.html#l00245">resource_limits.cpp:245</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue May 29 2018 17:40:54 for Eos by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
